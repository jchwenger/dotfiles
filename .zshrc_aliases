# use 256 colors
export TERM='xterm-256color'
export LC_ALL=en_GB.UTF-8

# Processing command added in .profile # my own aliases
alias tor='cd $HOME/tor-browser_en-US; ./start-tor-browser.desktop; cd -'

alias prc=processing
alias prj=processing-java
prw() {
  processing-java --sketch="$(pwd)" --run;
}
prd() {
  if [ -z "$1" ]
  then
    echo "specify dir"
    exit
  fi
  processing-java --sketch="$1" --run;
}

alias jek='bundle exec jekyll serve'
alias jei='bundle exec jekyll serve --incremental' # does not reload the _config.yml file
alias bfg='java -jar ~/bfg-repo-cleaner/bfg-1.13.0.jar'
alias jn='jupyter notebook'
alias jl='jupyter lab'

alias nau="nautilus . & disown"
alias ff="firefox"

alias xr='xreader'
alias xv='xviewer'

wr() {
  libreoffice --writer -o "$@" &;
}

alias tl="$HOME/talon/run.sh"

alias stats="stat -c %y"

# Space occupied by files, human readable, descending
alias dus="du -sh * | sort -h"

# Free space, without header, human readable, (4th column descending)
alias dfs="df -h | tail -n +2 | sort -hk 4"

alias p="ipython"

alias v="vim ."
alias vo="vim -O"
alias g="gvim ."
alias n="nvim ."
alias gim="gvim -v"
alias nim="nvim"

alias vc="vim ~/.vimrc"
alias vz="vim ~/.zshrc"
alias va="vim $HOME/dotfiles/.zshrc_aliases"
alias vt="vim ~/.tmux.conf"
alias vp="vim $HOME/dotfiles/.zshrc_paths"
alias vdt="vim $HOME/dotfiles"
alias vst="vim $HOME/dotfiles/install/install.sh"
alias vw="vim -c 'cd /home/jcw/Dropbox/lit/it/VI/words | pwd'"
alias vm="vim -c 'cd /home/jcw/Dropbox/lit/it/VI/more | pwd'"
alias vv="vim -c 'cd /home/jcw/Documents/vocabulary | pwd'"
alias vl="cd $HOME/.talon/user/knausj_talon; vim ."

alias rng="$HOME/ranger/ranger.py"
# alias rng='/usr/local/bin/ranger'
alias tm="$HOME/tmux/tmux"
# alias tm='/usr/local/bin/tmux'
export PATH="$PATH:$HOME/tmux"

alias so='source ~/.zshrc'

alias l1='ls -1'

# some more ls aliases
# alias ll='ls -alF'
# alias la='ls -A'
# alias l='ls -CF'

# remove directories
alias rmd='rm -r'
alias rmdf='rm -rf'

# copy directories
alias cpr='cp -r'

# zip directories
alias zipr='zip -r'

# wrapping git with hub
# eval "$(hub alias -s)"

alias j='jobs'

# gpu status
alias wa='watch -n 1 nvidia-smi'

# reload gpu
# https://forums.fast.ai/t/reset-gpu-without-restarting-linux/14136/7
alias gpureload="sudo rmmod nvidia_uvm ; sudo modprobe nvidia_uvm"

# easy xclip wtih |X
alias -g XCL='| xclip -sel clip'

# conda activate envs
alias cab='conda activate base'
alias cag='conda activate gold'
alias cad='conda deactivate'

# aria helper
# https://unix.stackexchange.com/a/134286
magnet-info() {
  hash=$(echo "$1" | grep -oP "(?<=btih:).*?(?=&)")
  echo "Magnet hash: $hash"
  aria2c --bt-metadata-only=true --bt-save-metadata=true -q "$1"
  aria2c "$hash.torrent" -S
}

# find in current directory
fin() {
  find . -iname "*$**" -printf '%Ac %p \n';
}

# find in root directory
finr() {
  sudo find / -path /media/$(whoami)/windows -prune -o -iname "*$**" -printf '%Ac %p \n';
}

# https://stackoverflow.com/a/17841619
join_by() {
  local d=$1;
  shift;
  echo -n "$1";
  shift;
  printf "%s" "${@/#/$d}";
}

# find in lit
flit() {

  cd $lit;

  # use regex to search for search\ string as well as search-string
  search_string=$(join_by '[ -]' $*);
  # echo $search_string;

  # "$*" expands to "$1c$2c...", c = first char in IFS
  # "$@" on the contrary expands to "$1" "$2" ...
  find . -iname "*$search_string*" -exec stat -c "%.19y %n" {} \;
  # find . -iname "*$**" -printf '%Cc %f %h \n';

  cd ~-;
}

# same as above, with full paths (pipeable)
fl() {
  search_string=$(join_by '[ -]' $*);
  find $lit -iname "*$search_string*" -print0
}

# find in Vocabulary
fvoc() {

  cd $voc;

  # use regex to search for search\ string as well as search-string
  search_string=$(join_by '[ -]' $*);
  # echo $search_string;

  find  -iname "*$search_string*" -exec stat -c "%.19y %n" {} \;

  cd ~-;
  # find /media/$(whoami)/windows/Users/user/OneDrive/vocabulary -iname "*$**" -printf '%Ac %f \n';
}

# Now using the .oh-my-zsh aliases & plugins

# To see the options, grep through aliases using this alias
# alias ali='alias | grep'
ali() {
  alias | grep "$*"
}

# To open the online wiki
alias zref='firefox https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins'

# To edit oh-my-zsh shortcuts
alias ohmy='vim ~/.oh-my-zsh'

# lp print portrait, landscape
alias lpv='lp -o fit-to-page -o sides=two-sided-long-edge'
alias lph='lp -o fit-to-page -o sides=two-sided-short-edge'

lpvtxt() {
  total=""
  for f in $*
  do
    if [[ $f =~ ${@: -1} ]]
    then
      total="$total$(cat $f)"
    else
      total="$total$(cat $f)\f"
    fi
  done
  echo $total \
  | lp \
      -o media=a4 \
      -o cpi=12 \
      -o lpi=7.2 \
      -o page-left=48 \
      -o page-right=48 \
      -o page-top=48 \
      -o page-bottom=48 \
      -o sides=two-sided-long-edge
}

lphtxt() {
  for f in $*
  do
    if [[ $f =~ ${@: -1} ]]
    then
      total="$total$(cat $f)"
    else
      total="$total$(cat $f)\f"
    fi
  done
  echo $total \
  | lp \
      -o media=a4 \
      -o cpi=12 \
      -o lpi=7.2 \
      -o page-left=48 \
      -o page-right=48 \
      -o page-top=48 \
      -o page-bottom=48 \
      -o sides=two-sided-short-edge
}

pandoc_txt2docx() {
  fname="$1"
  # echo "${@:2}"
  total=""
  for f in ${@:2}
  do
    # echo "$f"
    if [[ $f =~ ${@: -1} ]]
    then
      total="$total$(cat $f | sed 's/^\*\*\*$/☙/')"
    else
      total="$total$(cat $f | sed 's/^\*\*\*$/☙/')\n\n\\pagebreak\n\n"
    fi
  done

  # add two spaces at the end of § lines for markdown
  # total=$(echo -e $total | perl -0777 -pe 's/(.)\n(?!\n)/$1  \n/')

  # echo $total
  echo "$total" | pandoc -f markdown -t docx --lua-filter=pagebreak.lua -s -o $fname
}

# xrandr rotate external screen
alias xrl='xrandr --output DP2 --rotate left'
alias xrn='xrandr --output DP2 --rotate normal'

# merging several pdfs into one, thanks to this reference
# https://stackoverflow.com/a/19358402
# used like so: $ pdfmerge outputname input1 input2 ...
# preserve links with -dPrinted, see:
# https://tex.stackexchange.com/a/458631
pdfmerge() {
  gs \
    -sDEVICE=pdfwrite \
    -dCompatibilityLevel=1.4 \
    -dPDFSETTINGS=/default \
    -dPrinted=false \
    -dNOPAUSE \
    -dQUIET \
    -dBATCH \
    -dDetectDuplicateImages \
    -dCompressFonts=true \
    -r150 \
    -sOutputFile=$1 ${@:2}
}

# stretch routine
stretch_routine() {
  cvlc --play-and-exit /usr/share/sounds/freedesktop/stereo/bell.oga
  for i in {0..5}
  do
    sleep 60
    cvlc --play-and-exit /usr/share/sounds/freedesktop/stereo/complete.oga
  done
  sleep $((60*2))
  cvlc --play-and-exit /usr/share/sounds/freedesktop/stereo/complete.oga
  cvlc --play-and-exit /usr/share/sounds/freedesktop/stereo/bell.oga
}

work_routine() {

  if [ $# -ne 1 ]
  then
    echo "specify minutes"
    return
  fi

  while true
  do
    stretch_routine
    sleep $((60*$1)) # specify number of minutes
  done
}

# restart wifi
alias restartwifi='sudo modprobe -r 8821ce && sleep 5 && sudo modprobe 8821ce'

# to convert images to pdf
# convert *.jpg -quality 100 outfile.pdf

# Useful command to repeat the last command while adding something in front of it
# $ !!
# Ex:
# $ sudo !!

alias pavu='pavucontrol'

alias echopath="printf '%s\n' \"$PATH\" | tr ':' '\n'"

# Disable CTRL-S and CTRL-Q
# [[ $- =~ i ]] && stty -ixoff -ixon

# https://askubuntu.com/a/1110354
function reload_gtk_theme() {
  theme=$(gsettings get org.gnome.desktop.interface gtk-theme)
  gsettings set org.gnome.desktop.interface gtk-theme ''
  sleep 1
  gsettings set org.gnome.desktop.interface gtk-theme $theme
}

# add openFrameworks path as a global variable
export PG_OF_PATH="$docs/of_v0.11.0_linux64gcc6_release"
export OF_PATH="$docs/of_v0.11.0_linux64gcc6_release"
export OF_APPS="$OF_PATH/apps/myApps"

alias ofm="conda deactivate && make && make RunRelease"

# alias musb='sudo mount /dev/sdc1 /media/$(whoami)/JESSH_USB && sudo mount /dev/sdb1 /media/$(whoami)/JESSH_USB'
# alias umusb='sudo umount /dev/sdc1 && sudo rmd -f /media/$(whoami)/JESSH_USB'

# PROMPT_COMMAND='echo -ne "\033]0;(basename ${PWD})\007"'
# PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD}\007"'

# add .local/bin to the path
export PATH="$PATH:$HOME/.local/bin"

# remove qt warning in IPython
export QT_STYLE_OVERRIDE="fusion"

# vim mode for zsh: reduce delay to 0.1 second
# https://dougblack.io/words/zsh-vi-mode.html
export KEYTIMEOUT=1

# bat https://github.com/sharkdp/bat
export PATH="$PATH:$HOME/bat-v0.12.1-x86_64-unknown-linux-gnu"

# fd https://github.com/sharkdp/fd
export PATH="$PATH:$HOME/fd-v7.4.0-x86_64-unknown-linux-gnu"

# add CUDA: https://askubuntu.com/a/1175482
export LD_LIBRARY_PATH="/usr/local/cuda-11/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}"
# export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CONDA_PREFIX/lib/


# dircolors as per https://github.com/aruhier/gnome-terminal-colors-solarized
# eval $(dircolors $HOME/.dir_colors/dircolors)

# do not stop at first option, but autocomplete it all
# https://unix.stackexchange.com/a/374868
# setopt menucomplete

# android sdk
export PATH="$PATH:$HOME/commandlinetools-linux-6200805_latest/bin"

# now using oh-my-zsh

# Add RVM to PATH for scripting. Make sure this is the last PATH variable change.
# export PATH="$PATH:$HOME/.rvm/bin"
# [[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm" # Load RVM into a shell session *as a function*

export PATH="$PATH:$HOME/git-filter-repo"

export PATH="$PATH:$HOME/pigz-2.6/"

# processing
export PATH="$PATH:$HOME/processing-4.0b7/"

# for zsh-vi-mode
# zvm_after_init_commands+=('[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh')

# tensorflow log levels
# https://stackoverflow.com/a/42121886
export TF_CPP_MIN_LOG_LEVEL=1

# tensorflow XLA
# https://stackoverflow.com/a/66028149
export TF_XLA_FLAGS="--tf_xla_enable_xla_devices"
